
[[gram5-audit-logging]]
== Audit Logging ==


[[gram5-audit-logging-overview]]
=== Overview ===

GRAM5 includes mechanisms to provide access to audit and accounting
information associated with jobs that GRAM5 submits to a local resource
manager (LRM) such as Torque, GridEngine, or Condor.

In some scenarios, it is desirable to get general information about the
usage of the underlying LRM, such as:




* What kinds of jobs were submitted via GRAM?

* How long did the processing of a job take?

* How many jobs were submitted by user X?


The following three use cases give a better overview of the meaning and
purpose of auditing and accounting:



. **Group Access**: A grid resource provider allows a remote service
(e.g., a gateway or portal) to submit jobs on behalf of multiple users.
The grid resource provider only obtains information about the identity
of the remote submitting service and thus does not know the identity of
the users for which the grid jobs are submitted. This group access is
allowed under the condition that the remote service stores audit
information so that, if and when needed, the grid resource provider can
request and obtain information to track a specific job back to an
individual user.

. **Query Job Accounting**: A client that submits a job needs to be able
to obtain, after the job has completed, information about the resources
consumed by that job. In portal and gateway environments where many
users submit many jobs against a single allocation, this per-job
accounting information is needed soon after the job completes so that
client-side accounting can be updated. Accounting information is
sensitive and thus should only be released to authorized parties.

. **Auditing**: In a distributed, multi-site environment, it can be
necessary to investigate various forms of suspected intrusion and abuse.
In such cases, we may need to access an audit trail of the actions
performed by a service. When accessing this audit trail, it will
frequently be important to be able to relate specific actions to the
user.


Audit logging in GRAM5 is done when a job completes.


=== Audit and Accounting Records ===

While audit and accounting records may be generated and stored by
different entities in different contexts, we make the following
assumptions in this chapter:



+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<informaltable>
      <tgroup cols='3'>
        <thead>
          <row>
            <entry>
            </entry>
            <entry>Audit Records</entry>
            <entry>Accounting Records</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>Generated by:</entry>
            <entry>GRAM service</entry>
            <entry>LRM to which the GRAM service submits jobs</entry>
          </row>
          <row>
            <entry>Stored in:</entry>
            <entry>Database, indexed by GJID</entry>
            <entry>LRM, indexed by JID</entry>
          </row>
          <row>
            <entry>Data that is stored:</entry>
            <entry>See list below.</entry>
            <entry>May include all information about the duration and resource-usage of a
              job</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

The audit record of each job contains the following data:




* **job_grid_id**: String representation of the resource EPR

* **local_job_id**: Job/process id generated by the scheduler

* **subject_name**: Distinguished name (DN) of the user

* **username**: Local username

* **idempotence_id**: Job id generated on the client-side

* **creation_time**: Date when the job resource is created

* **queued_time**: Date when the job is submitted to the scheduler

* **stage_in_grid_id**: String representation of the stageIn-EPR (RFT)

* **stage_out_grid_id**: String representation of the stageOut-EPR (RFT)

* **clean_up_grid_id**: String representation of the cleanUp-EPR (RFT)

* **globus_toolkit_version**: Version of the server-side GT

* **resource_manager_type**: Type of the resource manager (Fork, Condor,
...)

* **job_description**: Complete job description document

* **success_flag**: Flag that shows whether the job failed or finished
successfully

* **finished_flag**: Flag that shows whether the job is already fully
processed or still in progress

* **gateway_user**: Teragrid identity of the user which submitted the job.



=== For More Information ===

The rest of this chapter focuses on how to configure GRAM5 to enable
Audit-Logging. 


[[gram5-audit-logging-config]]
=== Configuration ===

Audit logging is turned off by default. To enable GRAM5 audit logging,
in the job manager, add the command-line option '-audit-directory ' to
the job manager configuration in one of the following locations: 

* ++$GLOBUS_LOCATION/etc/globus-job-manager.conf++ to enable it for all job manager services to enable it for all job manager services

* ++$GLOBUS_LOCATION/etc/grid-services/LRM_SERVICE_NAME++ to enable it for a particular job manager service for a particular LRM. to enable it for a particular job manager service for a particular LRM.




[[gram5-audit-logging-config-database]]
=== Audit Database Interface ===

The **++globus-gram-audit++** program reads GRAM5 audit records and
loads those records into a SQL database. This program is available as
part of the **++globus_gram_job_manager_auditing++** package. It must be
configured by installing and running the
**++globus_gram_job_manager_auditing_setup_scripts++** setup package via
**++gpt-postinstall++**. This setup script creates the
++$GLOBUS_LOCATION/etc/globus-job-manager-audit.conf++ configuration
file described below and creates database tables needed by the audit
system.  configuration file described below and creates database tables
needed by the audit system. 

The **++globus-gram-audit++** program support three database systems:
MySQL, PostgreSQL, and SQLite. 

