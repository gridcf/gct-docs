<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Grid Community Toolkit: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grid Community Toolkit
   &#160;<span id="projectnumber">6.2.1705709074 (tag: v6.2.20240202)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="contents">
<div class="textblock"><p>Net Manager Implementation Tutorial</p>
<p>This example uses functionality from globus_common and globus_net_manager modules, so the headers for those must be included: </p>
<pre class="fragment">#include "globus_common.h"
#include "globus_net_manager.h"</pre><p> To implement a network manager, define a struct <a class="el" href="structglobus__net__manager__s.html" title="Net Manager Definition. ">globus_net_manager_s</a> containing pointers to the functions in your code that you want invoked during network events, and pass that to <a class="el" href="group__globus__net__manager.html#ga4ab58b9b04f13ceaae51c492e4134fa3" title="Register a network manager. ">globus_net_manager_register()</a>. Applications which use the <a class="el" href="group__globus__net__manager__context.html">Context</a> functions or the <a class="el" href="group__globus__xio__net__manager__driver.html">Globus XIO Net Manager Driver</a> will invoke your functions as network operations occur. For this example (and I would imagine most real implementations), the globus_net_manager_t is statically initialized, like this:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span></div>
<div class="line"><a class="code" href="structglobus__net__manager__s.html">globus_net_manager_t</a>                    globus_l_net_manager_logging = {</div>
<div class="line">    <span class="stringliteral">&quot;logging&quot;</span>,</div>
<div class="line">    globus_l_net_manager_logging_pre_listen,</div>
<div class="line">    globus_l_net_manager_logging_post_listen,</div>
<div class="line">    globus_l_net_manager_logging_end_listen,</div>
<div class="line">    globus_l_net_manager_logging_pre_accept,</div>
<div class="line">    globus_l_net_manager_logging_post_accept,</div>
<div class="line">    globus_l_net_manager_logging_pre_connect,</div>
<div class="line">    globus_l_net_manager_logging_post_connect,</div>
<div class="line">    globus_l_net_manager_logging_pre_close,</div>
<div class="line">    globus_l_net_manager_logging_post_close</div>
<div class="line">};</div>
</div><!-- fragment --><p> For the examples provided in this library, the <a class="el" href="structglobus__net__manager__s.html" title="Net Manager Definition. ">globus_net_manager_s</a> is registered during module activation in a globus_extension module. This method makes it easy to use network managers in a shared library environment. This is also a good place to initialize any state that you need to retain between calls to the network manager.</p>
<p>To implement this, do the following: </p>
<div class="fragment"><div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">globus_l_net_manager_logging_activate(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="group__globus__hashtable.html#gaa8ebba0d8468b67381b0175bf43faaed">globus_hashtable_init</a>(</div>
<div class="line">        &amp;globus_l_nm_logging_logfiles,</div>
<div class="line">        7,</div>
<div class="line">        <a class="code" href="group__globus__hashtable.html#gac05ee5602556a81dd51b751d4d272ec6">globus_hashtable_string_hash</a>, </div>
<div class="line">        <a class="code" href="group__globus__hashtable.html#ga88f448b7a2be515743f19b9ab0fd38fd">globus_hashtable_string_keyeq</a>);</div>
<div class="line">    <span class="keywordtype">int</span> rc = <a class="code" href="group__globus__module.html#ga39d16a71e5334643b2dbadc85f7a8073">globus_module_activate</a>(<a class="code" href="group__globus__net__manager.html#ga4c471480390ed9844ebb688d70f63a0f">GLOBUS_NET_MANAGER_MODULE</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line">    {</div>
<div class="line">        rc = <a class="code" href="group__globus__net__manager.html#ga4ab58b9b04f13ceaae51c492e4134fa3">globus_net_manager_register</a>(</div>
<div class="line">            &amp;globus_l_net_manager_logging, </div>
<div class="line">            GlobusExtensionMyModule(globus_net_manager_logging));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> rc;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">globus_l_logging_logfiles_destroy(<span class="keywordtype">void</span> *datum)</div>
<div class="line">{</div>
<div class="line">    globus_l_nm_logging_logref_t        *logref = datum;</div>
<div class="line">    <span class="keywordflow">if</span> (logref)</div>
<div class="line">    {</div>
<div class="line">        free(logref-&gt;key);</div>
<div class="line">        fclose(logref-&gt;handle);</div>
<div class="line">        free(logref);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">globus_l_net_manager_logging_deactivate(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    globus_hashtable_destroy_all(</div>
<div class="line">            &amp;globus_l_nm_logging_logfiles,</div>
<div class="line">            globus_l_logging_logfiles_destroy);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">int</span> rc = <a class="code" href="group__globus__net__manager.html#ga104686c95eb6ee3aa5a3d73fe4007c52">globus_net_manager_unregister</a>(&amp;globus_l_net_manager_logging);</div>
<div class="line">    <span class="keywordflow">if</span> (rc == 0)</div>
<div class="line">    {</div>
<div class="line">        rc = <a class="code" href="group__globus__module.html#ga09cf915fe65ec2afcf47e83c0942cb4e">globus_module_deactivate</a>(<a class="code" href="group__globus__net__manager.html#ga4c471480390ed9844ebb688d70f63a0f">GLOBUS_NET_MANAGER_MODULE</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> rc;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, the real work of the manager is done in the functions registered in the <a class="el" href="structglobus__net__manager__s.html" title="Net Manager Definition. ">globus_net_manager_s</a>. For brevity, I'll just include the pre_listen function in this tutorial. This function is passed the task-id associated with the operation, the transport ("tcp", "udp", "udt", etc) used by the network, and whatever attributes are associated with the operation. If we wanted to modify things before they were processed by the network, we could create a modified copy of the attributes in the pre_listen function and return them via the attr_array_out parameter. In this case, we simply print out the information we've received from the network stack.</p>
<div class="fragment"><div class="line"><span class="keyword">static</span></div>
<div class="line"><a class="code" href="group__globus__common.html#gab3aa7be121bcab5daf208d5d99b4e8f2">globus_result_t</a></div>
<div class="line">globus_l_net_manager_logging_pre_listen(</div>
<div class="line">    <span class="keyword">struct</span> <a class="code" href="structglobus__net__manager__s.html">globus_net_manager_s</a>        *manager,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structglobus__net__manager__attr__s.html">globus_net_manager_attr_t</a>    *manager_attr_array,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>                         *task_id,</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>                         *transport,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structglobus__net__manager__attr__s.html">globus_net_manager_attr_t</a>    *attr_array,</div>
<div class="line">    <a class="code" href="structglobus__net__manager__attr__s.html">globus_net_manager_attr_t</a>         **attr_array_out)</div>
<div class="line">{</div>
<div class="line">    FILE *                              logfile;</div>
<div class="line">    logfile = globus_l_net_manager_logging_get_logfile(manager_attr_array);</div>
<div class="line">    globus_l_net_manager_logging_log_header(logfile, manager, task_id, transport, <span class="stringliteral">&quot;pre_listen&quot;</span>);</div>
<div class="line">    globus_l_net_manager_logging_log_attrs(logfile, attr_array);</div>
<div class="line">    globus_l_net_manager_logging_log_footer(logfile);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="group__globus__common.html#gaf3ac2ee50ab4d174381c10b64a734d88">GLOBUS_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"><span class="comment">/* globus_l_net_manager_logging_pre_listen() */</span></div>
</div><!-- fragment --></div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
