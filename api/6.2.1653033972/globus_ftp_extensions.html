<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Grid Community Toolkit: $title</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Grid Community Toolkit
   &#160;<span id="projectnumber">6.2.1653033972 (tag: v6.2.20220524)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="contents">
<div class="textblock"><p>GridFTP: Protocol Extensions to FTP for the Grid</p>
<p><a class="anchor" id="page_extensions"></a> </p>
<h1><a class="anchor" id="extensions_intro"></a>
Introduction</h1>
<p>This section defines extensions to the FTP specification STD 9, RFC 959, <a class="el" href="globus_ftp_extensions.html#rfc959">FILE TRANSFER PROTOCOL (FTP)</a> (October 1985) These extensions provide striped data transfer, parallel data transfer, extended data transfer, data buffer size configuration, and data channel authentication.</p>
<p>The following new commands are introduced in this specification</p>
<ul>
<li><a class="el" href="globus_ftp_extensions.html#sec_SPAS">Striped Passive (SPAS)</a></li>
<li><a class="el" href="globus_ftp_extensions.html#sec_SPOR">Striped Data Port (SPOR)</a></li>
<li><a class="el" href="globus_ftp_extensions.html#sec_ERET">Extended Retrieve (ERET)</a></li>
<li><a class="el" href="globus_ftp_extensions.html#sec_ESTO">Extended Store (ESTO)</a></li>
<li><a class="el" href="globus_ftp_extensions.html#sec_SBUF">Set Data Buffer Size (SBUF)</a></li>
<li><a class="el" href="globus_ftp_extensions.html#sec_DCAU">Data Channel Authentication Mode (DCAU)</a></li>
</ul>
<p>A new transfer mode (<a class="el" href="globus_ftp_extensions.html#mode_e">extended-block mode</a>) is introduced for parallel and striped data transfers. Also, a set of extension <a class="el" href="globus_ftp_extensions.html#sec_OPTS">options to RETR</a> are added to control striped data layout and parallelism.</p>
<p>The following new feature names are to be included in the FTP server's response to FEAT if it implements the following sets of functionality</p>
<dl class="section user"><dt>PARALLEL</dt><dd>The server supports the SPOR, SPAS, the RETR options mentioned above, and extended block mode.</dd></dl>
<dl class="section user"><dt>ESTO</dt><dd>The server implements the ESTO command as described in this document.</dd></dl>
<dl class="section user"><dt>ERET</dt><dd>The server implements the ERET command as described in this document.</dd></dl>
<dl class="section user"><dt>SBUF</dt><dd>The server implements the SBUF command as described in this document.</dd></dl>
<dl class="section user"><dt>DCAU</dt><dd>The server implements the DCAU command as described in this document, including the requirement that data channels are authenticated by default, if <a class="el" href="globus_ftp_extensions.html#rfc2228">RFC 2228</a> authentication is used to establish the control channel.</dd></dl>
<h1><a class="anchor" id="term"></a>
Terminology</h1>
<dl class="section user"><dt>Parallel transfer</dt><dd>From a single data server, splitting file data for transfer over multiple data connections.</dd></dl>
<dl class="section user"><dt>Striped transfer</dt><dd>Distributing a file's data over multiple independent data nodes, and transerring over multiple data connections.</dd></dl>
<dl class="section user"><dt>Data Node</dt><dd>In a striped data transfer, a data node is one of the stripe destinations returned in the SPAS command, or one of the stripe destinations sent in the SPOR command.</dd></dl>
<dl class="section user"><dt>DTP</dt><dd>The data transfer process establishes and manages the data connection. The DTP can be passive or active.</dd></dl>
<dl class="section user"><dt>PI</dt><dd>The protocol interpreter. The user and server sides of the protocol have distinct roles implemented in a user-PI and a server-PI.</dd></dl>
<h1><a class="anchor" id="Existing"></a>
FTP Standards Used</h1>
<ul>
<li>RFC 959, <a class="el" href="globus_ftp_extensions.html#rfc959">FILE TRANSFER PROTOCOL (FTP)</a>, J. Postel, R. Reynolds (October 1985)<ul>
<li>Commands used by GridFTP<ul>
<li>USER</li>
<li>PASS</li>
<li>ACCT</li>
<li>CWD</li>
<li>CDUP</li>
<li>QUIT</li>
<li>REIN</li>
<li>PORT</li>
<li>PASV</li>
<li>TYPE</li>
<li>MODE</li>
<li>RETR</li>
<li>STOR</li>
<li>STOU</li>
<li>APPE</li>
<li>ALLO</li>
<li>REST</li>
<li>RNFR</li>
<li>RNTO</li>
<li>ABOR</li>
<li>DELE</li>
<li>RMD</li>
<li>MKD</li>
<li>PWD</li>
<li>LIST</li>
<li>NLST</li>
<li>SITE</li>
<li>SYST</li>
<li>STAT</li>
<li>HELP</li>
<li>NOOP</li>
</ul>
</li>
<li>Features used by GridFTP<ul>
<li>ASCII and Image types</li>
<li>Stream mode</li>
<li>File structure</li>
</ul>
</li>
</ul>
</li>
<li>RFC 2228, <a class="el" href="globus_ftp_extensions.html#rfc2228">FTP Security Extensions</a>, Horowitz, M. and S. Lunt (October 1997)<ul>
<li>Commands used by GridFTP<ul>
<li>AUTH</li>
<li>ADAT</li>
<li>MIC</li>
<li>CONF</li>
<li>ENC</li>
</ul>
</li>
<li>Features used by GridFTP<ul>
<li>GSSAPI authentication</li>
</ul>
</li>
</ul>
</li>
<li>RFC 2389, <a class="el" href="globus_ftp_extensions.html#rfc2389">Feature negotiation mechanism for the File Transfer Protocol</a>, P. Hethmon , R. Elz (August 1998)<ul>
<li>Commands used by GridFTP<ul>
<li>FEAT</li>
<li>OPTS</li>
</ul>
</li>
<li>Features used by GridFTP</li>
</ul>
</li>
<li><a class="el" href="globus_ftp_extensions.html#ietfftpext">FTP Extensions</a>, R. Elz, P. Hethmon (September 2000)<ul>
<li>Commands used by GridFTP<ul>
<li>SIZE</li>
</ul>
</li>
<li>Features used by GridFTP<ul>
<li>Restart of a stream mode transfer</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a class="anchor" id="sec_SPAS"></a></p>
<h1><a class="anchor" id="SPAS"></a>
Striped Passive (SPAS)</h1>
<p>This extension is used to establish a vector of data socket listeners for for a server with one or more stripes. This command MUST be used in conjunction with the extended block mode. The response to this command includes a list of host and port addresses the server is listening on.</p>
<p>Due to the nature of the extended block mode protocol, SPAS must be used in conjunction with data transfer commands which receive data (such as STOR, ESTO, or APPE) and can not be used with commands which send data on the data channels.</p>
<dl class="section user"><dt>Syntax</dt><dd></dd></dl>
<p>The syntax of the SPAS command is:</p>
<div class="fragment"><div class="line">spas = <span class="stringliteral">&quot;SPAS&quot;</span> &lt;CRLF&gt;</div>
</div><!-- fragment --><dl class="section user"><dt>Responses</dt><dd></dd></dl>
<p>The server-PI will respond to the SPAS command with a 229 reply giving the list of host-port strings for the remote server-DTP or user-DTP to connect to.</p>
<div class="fragment"><div class="line">spas-response = <span class="stringliteral">&quot;229-Entering Striped Passive Mode&quot;</span> CRLF</div>
<div class="line">                 1*(&lt;SP&gt; host-port CRLF)</div>
<div class="line">                 229 End</div>
</div><!-- fragment --><p>Where the command is correctly parsed, but the server-DTP cannot process the SPAS request, it must return the same error responses as the PASV command.</p>
<dl class="section user"><dt>OPTS for SPAS</dt><dd></dd></dl>
<p>There are no options in this SPAS specification, and hence there is no OPTS command defined.</p>
<p><a class="anchor" id="sec_SPOR"></a></p>
<h1><a class="anchor" id="SPOR"></a>
Striped Data Port (SPOR)</h1>
<p>This extension is to be used as a complement to the SPAS command to implement striped third-party transfers. This command MUST always be used in conjunction with the extended block mode. The argument to SPOR is a vector of host/TCP listener port pairs to which the server is to connect. This</p>
<p>Due to the nature of the extended block mode protocol, SPOR must be used in conjunction with data transfer commands which send data (such as RETR, ERET, LIST, or NLST) and can not be used with commands which receive data on the data channels.</p>
<dl class="section user"><dt>Syntax</dt><dd></dd></dl>
<p>The syntax of the SPOR command is:</p>
<div class="fragment"><div class="line">SPOR 1*(&lt;SP&gt; &lt;host-port&gt;) &lt;CRLF&gt;</div>
</div><!-- fragment --><p>The host-port sequence in the command structure MUST match the host-port replies to a SPAS command.</p>
<dl class="section user"><dt>Responses</dt><dd></dd></dl>
<p>The server-PI will respond to the SPOR command with the same response set as the PORT command described in the <a class="el" href="globus_ftp_extensions.html#rfc959">ftp specification</a>.</p>
<dl class="section user"><dt>OPTS for SPOR</dt><dd></dd></dl>
<p>There are no options in this SPOR specification, and hence there is no OPTS command defined.</p>
<p><a class="anchor" id="sec_ERET"></a></p>
<h1><a class="anchor" id="ERET"></a>
Extended Retrieve (ERET)</h1>
<p>The extended retrieve extension is used to request that a retrieve be done with some additional processing on the server. This command an extensible way of providing server-side data reduction or other modifications to the RETR command. This command is used in place of OPTS to the RETR command to allow server side processing to be done with a single round trip (one command sent to the server instead of two) for latency-critical applications.</p>
<p>ERET may be used with either the data transports defined in RFC 959, or using extended block mode as defined in this document. Using an ERET creates a new virtual file which will be sent, with it's own size and byte range starting at zero. Restart markers generated while processing an ERET are relative to the beginning of this view of the file.</p>
<dl class="section user"><dt>Syntax</dt><dd></dd></dl>
<p>The syntax of the ERET command is </p>
<div class="fragment"><div class="line">ERET &lt;SP&gt; &lt;retrieve-mode&gt; &lt;SP&gt; &lt;filename&gt;</div>
<div class="line"></div>
<div class="line">retrieve-mode ::= P &lt;SP&gt; &lt;offset&gt; &lt;SP&gt; &lt;size&gt;</div>
<div class="line">offset ::= 64 bit integer</div>
<div class="line">size ::= 64 bit integer</div>
</div><!-- fragment --><p>The <b>retrieve-mode</b> defines behavior of the extended-retrieve mode. There is one mode defined by this specification, but other general purpose or application-specific ones may be added later.</p>
<dl class="section user"><dt>modes_ERET Extended Retrieve Modes</dt><dd></dd></dl>
<dl class="section user"><dt>Partial Retrieve Mode (P)</dt><dd>A section of the file will be retrieved from the data server. The section is defined by the starting <b>offset</b> and extent <b>size</b> parameters. When used with extended block mode, the extended block headers sent along with data will send the data with offset of 0 meaning the beginning of the section of the file which was requested.</dd></dl>
<p><a class="anchor" id="sec_ESTO"></a></p>
<h1><a class="anchor" id="ESTO"></a>
Extended Store (ESTO)</h1>
<p>The extended store extension is used to request that a store be done with some additional processing on the server. Arbitrary data processing algorithms may be added by defining additional ESTO store-modes. Similar to the ERET, the ESTO command expects data sent to satisfy the request to be sent as if it were a new file with data block offset 0 being beginning the beginning of the new file.</p>
<p>The format of the ESTO command is </p>
<div class="fragment"><div class="line">ESTO &lt;SP&gt; &lt;store-mode&gt; &lt;filename&gt;</div>
<div class="line"></div>
<div class="line">store-mode ::= A &lt;SP&gt; &lt;offset&gt;</div>
</div><!-- fragment --><p>The store-mode defines the behavior of the extended store. There is one mode defined by this specification, but others may be added later.</p>
<dl class="section user"><dt>Extended Store Modes</dt><dd></dd></dl>
<dl class="section user"><dt>Adjusted store (A)</dt><dd>The data in the file is to stored with <b>offset</b> added to the file pointer before storing the blocks of the file. In extended block mode, this value is added to the offset in the extended block header by the server when writing to disk. Extended block headers should therefore send the beginning of the byte range on the data channel with offset of zero. In stream mode, the offset is added to the implicit offset of 0 for the beginning of the data before writing. If a stream mode restart marker is used in conjunction with this ESTO mode, the restart marker's offset is added to the offset passed as the parameter to the adjusted store.</dd></dl>
<p><a class="anchor" id="sec_SBUF"></a></p>
<h1><a class="anchor" id="SBUF"></a>
Set Buffer Size (SBUF)</h1>
<p>This extension adds the capability of a client to set the TCP buffer size for subsequent data connections to a value. This replaces the server-specific commands SITE RBUFSIZE, SITE RETRBUFSIZE, SITE RBUFSZ, SITE SBUFSIZE, SITE SBUFSZ, and SITE BUFSIZE. Clients may wish to consider supporting these other commands to ensure wider compatibility.</p>
<dl class="section user"><dt>Syntax</dt><dd></dd></dl>
<p>The syntax of the SBUF command is</p>
<div class="fragment"><div class="line">sbuf = SBUF &lt;SP&gt; &lt;buffer-size&gt;</div>
<div class="line"></div>
<div class="line">buffer-size ::= &lt;number&gt;</div>
</div><!-- fragment --><p>The <b>buffer-size</b> value is the TCP buffer size in bytes. The TCP window size should be set accordingly by the server.</p>
<dl class="section user"><dt>Response Codes</dt><dd></dd></dl>
<p>If the server-PI is able to set the buffer size state to the requested <b>buffer-size</b>, then it will return a 200 reply.</p>
<dl class="section note"><dt>Note</dt><dd>Even if the SBUF is accepted by the server, an error may occur later when the data connections are actually created, depending on how the server or client operating systems' TCP implementations.</dd></dl>
<p><a class="anchor" id="sec_DCAU"></a></p>
<h1><a class="anchor" id="DCAU"></a>
Data Channel Authentication (DCAU)</h1>
<p>This extension provides a method for specifying the type of authentication to be performed on FTP data channels. This extension may only be used when the control connection was authenticated using RFC 2228 Security extensions.</p>
<p>The format of the DCAU command is </p>
<div class="fragment"><div class="line">DCAU &lt;SP&gt; &lt;authentication-mode&gt; &lt;CRLF&gt;</div>
<div class="line"></div>
<div class="line">authentication-mode ::= &lt;no-authentication&gt;</div>
<div class="line">                      | &lt;authenticate-with-<span class="keyword">self</span>&gt;</div>
<div class="line">                      | &lt;authenticate-with-subject&gt;</div>
<div class="line"></div>
<div class="line">no-authentication ::= N</div>
<div class="line">authenticate-with-<span class="keyword">self</span> ::= A</div>
<div class="line">authenticate-with-subject ::= S &lt;subject-name&gt;</div>
<div class="line"></div>
<div class="line">subject-name ::= <span class="keywordtype">string</span></div>
</div><!-- fragment --><dl class="section user"><dt>Authentication Modes</dt><dd><ul>
<li>No authentication (<b>N</b>)<br/>
 No authentication handshake will be done upon data connection establishment.</li>
<li>Self authentication (<b>A</b>)<br/>
 A security-protocol specific authentication will be used on the data channel. The identity of the remote data connection will be the same as the identity of the user which authenticated to the control connection.</li>
<li>Subject-name authentication (<b>S</b>)<br/>
 A security-protocol specific authentication will be used on the data channel. The identity of the remote data connection MUST match the supplied <b>subject-name</b> string.</li>
</ul>
</dd></dl>
<p>The default data channel authentication mode is <b>A</b> for FTP sessions which are RFC 2228 authenticated&mdash;the client must explicitly send a DCAU N message to disable it if it does not implement data channel authentication.</p>
<p>If the security handshake fails, the server should return the error response 432 (Data channel authentication failed).</p>
<h1><a class="anchor" id="mode_e"></a>
Extended Block Mode</h1>
<p>The striped and parallel data transfer methods described above require an extended transfer mode to support out-of-sequence data delivery, and partial data transmission per data connection. The extended block mode described here extends the block mode header to provide support for these as well as large blocks, and end-of-data synchronization.</p>
<p>Clients indicate that they want to use extended block mode by sending the command</p>
<div class="fragment"><div class="line">MODE &lt;SP&gt; E &lt;CRLF&gt;</div>
</div><!-- fragment --><p>on the control channel before a transfer command is sent.</p>
<p>The structure of the extended block header is </p>
<div class="fragment"><div class="line">Extended Block Header</div>
<div class="line"></div>
<div class="line">+----------------+-------/-----------+------/------------+</div>
<div class="line">| Descriptor     |    Byte Count     |    Offset Count   |</div>
<div class="line">|         8 bits |        64 bits    |          64 bits  |</div>
<div class="line">+----------------+-------/-----------+------/------------+</div>
</div><!-- fragment --><p>The descriptor codes are indicated by bit flags in the descriptor byte. Six codes have been assigned, where each code number is the decimal value of the corresponding bit in the byte.</p>
<div class="fragment"><div class="line">Code     Meaning</div>
<div class="line"></div>
<div class="line"> 128     End of data block is EOR (Legacy)</div>
<div class="line">  64     End of data block is EOF</div>
<div class="line">  32     Suspected errors in data block</div>
<div class="line">  16     Data block is a restart marker</div>
<div class="line">   8     End of data block is EOD <span class="keywordflow">for</span> a parallel/striped transfer</div>
<div class="line">   4     Sender will close the data connection</div>
</div><!-- fragment --><p>With this encoding, more than one descriptor coded condition may exist for a particular block. As many bits as necessary may be flagged.</p>
<p>Some additional protocol is added to the extended block mode data channels, to properly handle end-of-file detection in the presence of an unknown number of data streams.</p>
<ul>
<li>When no more data is to be sent on the data channel, then the sender will mark the last block, or send a zero-length block after the last block with the EOD bit (8) set in the extended block header.</li>
<li>After receiving an EOD the data connection can be cached for use in a subsequent transfer. To signifiy that the data connection will be closed the sender sets the close bit (4) in the header on the last message sent.</li>
<li>The sender communicates end of file by sending an EOF message to all servers receiving data. The EOF message format follows.</li>
</ul>
<p>Extended Block EOF Header </p>
<div class="fragment"><div class="line">+----------------+-------/--------+------/---------------+</div>
<div class="line">| Descriptor     |     unused     |  EOD count expected  |</div>
<div class="line">|         8 bits |     64 bits    |        64 bits       |</div>
<div class="line">+----------------+-------/--------+------/---------------+</div>
</div><!-- fragment --><p>EOF Descriptor. The EOF header descriptor has the same definition as the regular data message header described above.</p>
<p>EOD Count Expected. This 64 bit field represents the total number of data connections that will be established with the server receiving the file. This number is used by the receiver to determine it has received all of the data. When the number of EOD messages received equals the number represented by the "EOD Count Expected" field the receiver has hit end of file.</p>
<p>Simply waiting for EOD on all open data connections is not sufficient. It is possible that the receiver reads an EOD message on all of its open data connects while an additional data connection is in flight. If the receiver were to assume it reached end of file it would fail to receive the data on the in flight connection.</p>
<p>To handle EOF in the multi-striped server case a 126 response has been introduced. When receiving data from a striped server a client makes a control connection to a single host, but several host may create several data connections back to the client. Each host can independently decide how many data connections it will use, but only a single EOF message may be sent to back to the client, therefore it must be possible to aggregate the total number of data connections used in the transfer across the stripes. The 126 response serves this purpose.</p>
<p>The 126 is an intermediate response to RETR command. It has the following format.</p>
<div class="fragment"><div class="line">126 &lt;SP&gt; 1*(count of data connections)</div>
</div><!-- fragment --><p>Several "Count of data connections" can be in a single reply. They correspond to the stripes returned in the response to the SPAS command.</p>
<p>Discussion of protocol change to enable bidirectional data channels brought up the following problem if doing bidirectional data channels</p>
<p>If the client is pasv, and sending to a multi-stripe server, then the server creates data connections connections; since the client didn't do SPAS, it cannot associate HOST/PORT pairs on the data connections with stripes on the server (it doesn't even know how many there are). it cannot reliably determine which nodes to send data to. (Becomes even more complex in the third-party transfer case, because the sender may have multiple stripes of data.) The basic problem is that we need to know logical stripe numbers to know where to send the data.</p>
<dl class="section user"><dt>EOF Handling in Extended Block Mode</dt><dd></dd></dl>
<p>If you are in either striped or parallel mode, you will get exactly one EOF on each SPAS-specified ports (stripes). Hosts in extended block mode must be prepared to accept an arbitrary number of connections on each SPOR port before the EOF block is sent.</p>
<dl class="section user"><dt>Restarting</dt><dd></dd></dl>
<p>In general, opaque restart markers passed via the block header should not be used in extended block mode. Instead, the destination server should send extended data marker responses over the control connection, in the following form:</p>
<div class="fragment"><div class="line">extended-mark-response = <span class="stringliteral">&quot;111&quot;</span> &lt;SP&gt; <span class="stringliteral">&quot;Range Marker&quot;</span> &lt;SP&gt; &lt;byte-ranges-list&gt;</div>
<div class="line"></div>
<div class="line">byte-ranges-list       = &lt;byte-range&gt; [ *(<span class="stringliteral">&quot;,&quot;</span> &lt;byte-range&gt;) ]</div>
<div class="line">byte-range             = &lt;start-offset&gt; <span class="stringliteral">&quot;-&quot;</span> &lt;end-offset&gt;</div>
<div class="line"></div>
<div class="line">start-offset         ::= &lt;number&gt;</div>
<div class="line">end-offset           ::= &lt;number&gt;</div>
</div><!-- fragment --><p>The byte ranges in the marker are an incremental set of byte ranges which have been stored to disk by the data server. The complete restart marker is a concatenation of all byte ranges received by the client in 111 responses.</p>
<p>The client MAY combine adjacent ranges received over several range responses into any number of ranges when sending the REST command to the server to restart a transfer.</p>
<p>For example, the client, on receiving the responses:</p>
<div class="fragment"><div class="line">111 Range Marker 0-29</div>
<div class="line">111 Range Marker 30-89</div>
</div><!-- fragment --><p>may send, equivalently,</p>
<div class="fragment"><div class="line">REST 0-29,30-89</div>
<div class="line">REST 0-89</div>
<div class="line">REST 30-59,0-29,60-89</div>
</div><!-- fragment --><p>to restart the transfer after those 90 bytes have been received.</p>
<p>The server MAY indicate that a given range of data has been received in multiple subsequent range markers. The client MUST be able to handle this. For example:</p>
<div class="fragment"><div class="line">111 Range Marker 30-59</div>
<div class="line">111 Range Marker 0-89</div>
</div><!-- fragment --><p>is equivalent to</p>
<div class="fragment"><div class="line">111 Range Marker 30-59</div>
<div class="line">111 Range Marker 0-29,60-89</div>
</div><!-- fragment --><p>Similarly, the client, if it is doing no processing of the restart markers, MAY send redundant information in a restart.</p>
<p><em>Should these be allowed as restart markers for stream mode?</em></p>
<dl class="section user"><dt>Performance Monitoring</dt><dd></dd></dl>
<p>In order to monitor the performance of extended block mode transfer, an additional preliminary reply MAY be transmitted over the control channel. This reply is of the form:</p>
<div class="fragment"><div class="line">extended-perf-response  = <span class="stringliteral">&quot;112-Perf Marker&quot;</span> CRLF</div>
<div class="line">                          &lt;SP&gt; <span class="stringliteral">&quot;Timestamp:&quot;</span> &lt;SP&gt; &lt;timestamp&gt; CRLF</div>
<div class="line">              &lt;SP&gt; <span class="stringliteral">&quot;Stripe Index:&quot;</span> &lt;SP&gt; &lt;stripe-number&gt; CRLF</div>
<div class="line">              &lt;SP&gt; <span class="stringliteral">&quot;Stripe Bytes Transferred:&quot;</span> &lt;SP&gt; &lt;byte count&gt; CRLF</div>
<div class="line">              &lt;SP&gt; <span class="stringliteral">&quot;Total Stripe Count:&quot;</span> &lt;SP&gt; &lt;stripe count&gt; CRLF</div>
<div class="line">                          <span class="stringliteral">&quot;112 End&quot;</span> CRLF</div>
<div class="line"></div>
<div class="line">timestamp               = &lt;number&gt; [ <span class="stringliteral">&quot;.&quot;</span> &lt;digit&gt; ]</div>
</div><!-- fragment --> <p>&lt;timestamp&gt; is seconds since the epoch</p>
<p>The performance marker can contain these or any other perf-line facts which provide useful information about the current performance.</p>
<p>All perf-line facts represent an instantaneous state of the transfer at the given timestamp. The meaning of the facts are</p>
<ul>
<li>Timestamp - The time at which the server computed the performance information. This is in seconds since the epoch (00:00:00 UTC, January 1, 1970).</li>
<li>Stripe Index - the index (0-number of stripes on the STOR side of the transfer) which this marker pertains to.</li>
<li>Stripe Bytes Transferred - The number of bytes which have been received on this stripe.</li>
</ul>
<p>A transfer start time can be specified by a perf marker with 'Stripe Bytes Transferred' set to zero. Only the first marker per stripe can be used to specify the start time of that stripe. Any subsequent markers with 'Stripe Bytes Transferred' set to zero simply indicates no data transfer over the interval.</p>
<p>A server should send a 'start' marker for each stripe. A server should also send a final perf marker for each stripe. This is a marker with 'Stripe Bytes Transferred' set to the total transfer size for that stripe.</p>
<p><a class="anchor" id="sec_OPTS"></a></p>
<h1><a class="anchor" id="opts"></a>
Options to RETR</h1>
<p>The options described in this section provide a means to convey striping and transfer parallelism information to the server-DTP. For the RETR command, the Client-FTP may specify a parallelism and striping mode it wishes the server-DTP to use. These options are only used by the server-DTP if the retrieve operation is done in extended block mode. These options are implemented as <a class="el" href="globus_ftp_extensions.html#rfc2389">RFC 2389</a> extensions.</p>
<p>The format of the RETR OPTS is specified by: </p>
<div class="fragment"><div class="line">retr-opts     = <span class="stringliteral">&quot;OPTS&quot;</span> &lt;SP&gt; <span class="stringliteral">&quot;RETR&quot;</span> [&lt;SP&gt; option-list] CRLF</div>
<div class="line">option-list   = [ layout-opts <span class="stringliteral">&quot;;&quot;</span> ] [ parallel-opts <span class="stringliteral">&quot;;&quot;</span> ]</div>
<div class="line">layout-opts   = <span class="stringliteral">&quot;StripeLayout=Partitioned&quot;</span></div>
<div class="line">              | <span class="stringliteral">&quot;StripeLayout=Blocked;BlockSize=&quot;</span> &lt;block-size&gt;</div>
<div class="line">parallel-opts = <span class="stringliteral">&quot;Parallelism=&quot;</span> &lt;starting-parallelism&gt; <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line">                               &lt;minimum-parallelism&gt;  <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line">                               &lt;maximum-parallelism&gt;</div>
<div class="line"></div>
<div class="line">block-size           ::= &lt;number&gt;</div>
<div class="line">starting-parallelism ::= &lt;number&gt;</div>
<div class="line">minimum-parallelism  ::= &lt;number&gt;</div>
<div class="line">maximum-parallelism  ::= &lt;number&gt;</div>
</div><!-- fragment --><dl class="section user"><dt>Layout Options</dt><dd></dd></dl>
<p>The layout option is used by the source data node to send sections of the data file to the appropriate destination stripe. The various StripeLayout parameters are to be implemented as follows:</p>
<dl class="section user"><dt>Partitioned</dt><dd>A partitioned data layout is one where the data is distributed evenly on the destination data nodes. Only one contiguous section of data is stored on each data node. A data node is defined here a single host-port mentioned in the SPOR command</dd></dl>
<dl class="section user"><dt>Blocked</dt><dd>A blocked data layout is one where the data is distributed in round-robin fashion over the destination data nodes. The data distribution is ordered by the order of the host-port specifications in the SPOR command. The <b>block-size</b> defines the size of blocks to be distributed.</dd></dl>
<dl class="section user"><dt>PLVL Parallelism Options</dt><dd></dd></dl>
<p>The parallelism option is used by the source data node to control how many parallel data connections may be established to each destination data node. This extension option provides for both a fixed level of parallelism, and for adapting the parallelism to the host/network connection, within a range. If the <b>starting-parallelism</b> option is set, then the server-DTP will make <b>starting-parallelism</b> connections to each destination data node. If the <b>minimum-parallelism</b> option is set, then the server may reduce the number of parallel connections per destination data node to this value. If the <b>maximum-parallelism</b> option is set, then the server may increase the number of parallel connections to per destination data node to at most this value.</p>
<h1><a class="anchor" id="refs"></a>
References</h1>
<p><a class="anchor" id="rfc959"></a>[1] Postel, J. and Reynolds, J., "&lt;a
href="<a href="ftp://ftp.isi.edu/in-notes/rfc959.txt">ftp://ftp.isi.edu/in-notes/rfc959.txt</a>"&gt;
FILE TRANSFER PROTOCOL (FTP)&lt;/a&gt;", STD 9, RFC 959, October 1985.</p>
<p><a class="anchor" id="rfc2389"></a>[2] Hethmon, P. and Elz, R., "&lt;a
href="<a href="ftp://ftp.isi.edu/in-notes/rfc2389.txt">ftp://ftp.isi.edu/in-notes/rfc2389.txt</a>"&gt;
Feature negotiation mechanism for the File Transfer Protocol&lt;/a&gt;", RFC 2389, August 1998.</p>
<p><a class="anchor" id="rfc2228"></a>[3] Horowitz, M. and Lunt, S., "&lt;a
href="<a href="ftp://ftp.isi.edu/in-notes/rfc2228.txt">ftp://ftp.isi.edu/in-notes/rfc2228.txt</a>"&gt;
FTP Security Extensions&lt;/a&gt;", RFC 2228, October 1997.</p>
<p><a class="anchor" id="ietfftpext"></a>[4] Elz, R. and Hethom, P., "&lt;a
href="<a href="http://www.ietf.org/internet-drafts/draft-ietf-ftpext-mlst-13.txt">http://www.ietf.org/internet-drafts/draft-ietf-ftpext-mlst-13.txt</a>"&gt;
FTP Extensions&lt;/a&gt;", IETF Draft, May 2001.</p>
<h1><a class="anchor" id="appendix_i"></a>
Appendix I: Implementation under GSI</h1>
<p>There are several security components in this document which are extensions to the behavior of RFC 2228. These appendix attempts to clarify the protocol how these extensions map to the OpenSSL-based implementation of the GSSAPI known as GSI (Grid Security Infrastructure).</p>
<p>A client implementation which communicates with a server which supports the DCAU extension should delegate a limited credential set (using the GSS_C_DELEG_FLAG and GSS_C_GLOBUS_LIMITED_DELEG_PROXY_FLAG flags to <a class="el" href="group__globus__gsi__gssapi.html#gafe3c4cae871cb967991ae51e9a2dc904" title="Init Sec Context. ">gss_init_sec_context()</a>). If delegation is not performed, the client MUST request that DCAU be disable by requesting DCAU N, or the server will be unable to perform the default of DCAU A as described by this document.</p>
<p>When DCAU mode "A" or "S" is used, a separate security context is established on each data channel. The context is established by performing the GSSAPI handshake with the active-DTP calling <a class="el" href="group__globus__gsi__gssapi.html#gafe3c4cae871cb967991ae51e9a2dc904" title="Init Sec Context. ">gss_init_sec_context()</a> and the passive-DTP calling <a class="el" href="group__globus__gsi__gssapi.html#gab6e042896eadc9d5f1b06b8bc4dd5e6b" title="GSS Accept Security Context. ">gss_accept_sec_context()</a>. No delegation need be done on these data channels.</p>
<p>Data channel protection via the PROT command MUST always be used in conjunction with the DCAU A or DCAU S commands. If a PROT level is set, then messages will be wrapped according to RFC 2228 Appendix I using the contexts established on each data channel. Tokens transferred over the data channels when either PROT or DCAU is used are not framed in any way when using GSI. (When implementing this specification with other GSSAPI mechanisms, a 4 byte, big endian, binary token length should proceed all tokens).</p>
<p>If the DCAU mode or the PROT mode is changed between file transfers when caching data channels in extended block mode, all open data channels must be closed. This is because the GSI implementation does not support changing levels of protection on an existing connection. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
